#!/bin/bash

#
# packages/programs/package
#

DESCRIPTION='Configures pacman, installs AUR client, installs programs.'
INSTALL_MSG='Installing programs...'
UNINSTALL_MSG='Uninstalling programs...'

install() {
  echo -n 'checking if platform is Arch Linux... '
  local pacman_bin="$(which pacman)"
  if [[ -n ${pacman_bin} ]]; then
    success
  else
    failure
    echo 'skipping installation...'
    return 1
  fi

  echo -n 'copying pacman.conf... '
  if execute sudo cp "${PACKAGE_FILES}/pacman.conf" '/etc/pacman.conf'; then
    sudo chmod 644 /etc/pacman.conf
  else
    return 1
  fi

  echo -n 'refreshing pacman mirrors... '
  execute sudo ${pacman_bin} -Sy

  echo -n 'building and installing trizen for AUR support...'
  pushd ${PACKAGE_FILES}/trizen/ &> /dev/null
  execute makepkg --syncdeps --clean
  execute sudo ${pacman_bin} -U --noconfirm trizen-*.pkg.tar.xz
  popd &> /dev/null

  for program in $(cat "${PACKAGE_FILES}"/*.list); do
    echo -n "installing ${program}... "
    execute sudo pacman -S --noconfirm "${program}"
  done
}

uninstall() {
  return
}

post_update() {
  echo -n 'checking for system updates... '
  execute sudo pacman -Syu --noconfirm
  return $?
}
